<app-navbar></app-navbar>
<div class="workouts-container">
  <!-- Logo Header -->
  <div class="page-logo">
    <img src="/assets/Fitmos_icon.png" alt="Fitmos" />
  </div>

  <div class="workouts-header">
    <h1>üí™ Entra√Ænement</h1>
    <p>Enregistrez vos exercices pour suivre votre progressive overload</p>
  </div>

  @if (!isWorkoutActive()) {
    <!-- √âtat initial : pas d'entra√Ænement en cours -->
    <div class="empty-state">
      <div class="empty-icon">üèãÔ∏è</div>
      <h2>Commencez votre entra√Ænement</h2>
      <p>Enregistrez vos exercices, s√©ries, r√©p√©titions et poids pour suivre votre progression</p>
      <button class="btn btn-primary" (click)="startNewWorkout()">
        Commencer un entra√Ænement
      </button>
    </div>
  } @else {
    <!-- Entra√Ænement en cours -->
    <div class="current-workout">
      <div class="workout-header-bar">
        <div class="workout-info">
          <input
            type="text"
            [(ngModel)]="currentWorkout().name"
            class="workout-name-input"
            placeholder="Nom de l'entra√Ænement"
          />
          <p class="workout-date">{{ currentWorkout().date | date:'EEEE d MMMM y' }}</p>
        </div>
        <div class="workout-actions">
          <button class="btn btn-success" (click)="saveWorkout()">
            <svg width="18" height="18" viewBox="0 0 24 24" fill="currentColor">
              <path d="M9 16.17L4.83 12l-1.42 1.41L9 19 21 7l-1.41-1.41z"/>
            </svg>
            <span>Terminer</span>
          </button>
          <button class="btn btn-danger" (click)="cancelWorkout()">
            <svg width="18" height="18" viewBox="0 0 24 24" fill="currentColor">
              <path d="M19 6.41L17.59 5 12 10.59 6.41 5 5 6.41 10.59 12 5 17.59 6.41 19 12 13.41 17.59 19 19 17.59 13.41 12z"/>
            </svg>
            <span>Annuler</span>
          </button>
        </div>
      </div>

      <!-- Liste des exercices -->
      <div class="exercises-list">
        @for (exercise of currentWorkout().exercises; track $index) {
          <div class="exercise-card">
            <div class="exercise-header">
              <h3>{{ exercise.name }}</h3>
              <button class="btn-icon btn-danger" (click)="removeExercise($index)" title="Supprimer l'exercice">
                <svg width="18" height="18" viewBox="0 0 24 24" fill="currentColor">
                  <path d="M19 6.41L17.59 5 12 10.59 6.41 5 5 6.41 10.59 12 5 17.59 6.41 19 12 13.41 17.59 19 19 17.59 13.41 12z"/>
                </svg>
              </button>
            </div>
            
            <div class="sets-table">
              <div class="sets-header">
                <span>S√©rie</span>
                <span>Poids (kg)</span>
                <span>Reps</span>
              </div>
              
              @for (set of exercise.sets; track $index) {
                <div class="set-row">
                  <span class="set-number">{{ $index + 1 }}</span>
                  <span class="set-weight">{{ set.weight }} kg</span>
                  <span class="set-reps">{{ set.reps }} reps</span>
                </div>
              }
            </div>
          </div>
        }
      </div>

      <button class="btn btn-secondary add-exercise-btn" (click)="showAddExerciseModal.set(true)">
        ‚ûï Ajouter un exercice
      </button>

      <!-- Notes -->
      <div class="workout-notes">
        <label>Notes sur l'entra√Ænement</label>
        <textarea
          [(ngModel)]="currentWorkout().notes"
          placeholder="Comment vous sentez-vous ? Des observations ?"
          rows="3"
        ></textarea>
      </div>
    </div>
  }

  <!-- Historique des entra√Ænements -->
  @if (workouts().length > 0) {
    <div class="workouts-history">
      <h2>üìÖ Historique</h2>
      <div class="history-grid">
        @for (workout of workouts(); track workout.id) {
          <div class="history-card">
            <div class="history-header">
              <div class="history-title">
                <h3>{{ workout.name }}</h3>
                <span class="history-date">{{ workout.date | date:'d MMM' }}</span>
              </div>
              <div class="history-actions">
                <button class="btn-icon-action" (click)="editWorkout(workout)" title="Modifier">
                  <svg width="20" height="20" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2">
                    <path d="M11 4H4a2 2 0 0 0-2 2v14a2 2 0 0 0 2 2h14a2 2 0 0 0 2-2v-7"></path>
                    <path d="M18.5 2.5a2.121 2.121 0 0 1 3 3L12 15l-4 1 1-4 9.5-9.5z"></path>
                  </svg>
                </button>
                <button class="btn-icon-delete" (click)="deleteWorkout(workout.id)" title="Supprimer">
                  <svg width="20" height="20" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2">
                    <polyline points="3 6 5 6 21 6"></polyline>
                    <path d="M19 6v14a2 2 0 0 1-2 2H7a2 2 0 0 1-2-2V6m3 0V4a2 2 0 0 1 2-2h4a2 2 0 0 1 2 2v2"></path>
                    <line x1="10" y1="11" x2="10" y2="17"></line>
                    <line x1="14" y1="11" x2="14" y2="17"></line>
                  </svg>
                </button>
              </div>
            </div>
            <p class="history-exercises">{{ workout.exercises.length }} exercices</p>
            @if (workout.notes) {
              <p class="history-notes">{{ workout.notes }}</p>
            }
          </div>
        }
      </div>
    </div>
  }
</div>

<!-- Modal : Ajouter un exercice -->
@if (showAddExerciseModal()) {
  <div class="modal-overlay" (click)="showAddExerciseModal.set(false)">
    <div class="modal-content" (click)="$event.stopPropagation()">
      <div class="modal-header">
        <h2>‚ûï Ajouter un exercice</h2>
        <button class="btn-close" (click)="showAddExerciseModal.set(false)">‚úï</button>
      </div>

      <div class="modal-body">
        <div class="form-group">
          <label>Nom de l'exercice</label>
          <input
            type="text"
            [(ngModel)]="newExercise.name"
            placeholder="Ex: D√©velopp√© couch√©"
            class="form-input"
          />
        </div>

        <div class="form-group">
          <label>S√©ries</label>
          @for (set of newExercise.sets; track $index) {
            <div class="set-input-row">
              <span class="set-label">S√©rie {{ $index + 1 }}</span>
              <input
                type="number"
                [(ngModel)]="set.weight"
                placeholder="Poids (kg)"
                min="0"
                step="0.5"
                class="form-input-small"
              />
              <input
                type="number"
                [(ngModel)]="set.reps"
                placeholder="Reps"
                min="1"
                class="form-input-small"
              />
              @if (newExercise.sets.length > 1) {
                <button class="btn-icon btn-danger" (click)="removeSetFromNewExercise($index)">
                  ‚úï
                </button>
              }
            </div>
          }
          
          <button class="btn btn-secondary btn-sm" (click)="addSetToNewExercise()">
            ‚ûï Ajouter une s√©rie
          </button>
        </div>
      </div>

      <div class="modal-footer">
        <button class="btn btn-ghost" (click)="showAddExerciseModal.set(false)">
          Annuler
        </button>
        <button class="btn btn-primary" (click)="addExerciseToWorkout()">
          Ajouter l'exercice
        </button>
      </div>
    </div>
  </div>
}
